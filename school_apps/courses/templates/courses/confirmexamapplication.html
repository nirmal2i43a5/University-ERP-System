{% extends 'admin_templates/base_admin.html' %}


{% block title %}
  Confirm Exam Application
{% endblock title %}
{% block content %}



<section class="content">
    <div class="container-fluid">
  
      
      {% include "includes/messages.html" %}
      <div class="row">
        <div class="col-md-12">
          <!-- general form elements -->
          <div class="card card-info">
            <form class="form-inline my-2 mx-2">
                <div class="form-group mb-2">
                    <label for="application_id">Enter form number:&nbsp&nbsp </label>
                    <input type="text" id="application_id" class="form-control" placeholder="Enter Student Form Number"> &nbsp&nbsp
                    <button type="button" class="btn btn-primary" id="form-confirm-button">Confirm</button>
                </div>
            
                
            </form>
            <!-- <div id="application-list"> -->
                <!-- <table class="table table-hover">
                    <thead class="thead" style="background:-webkit-linear-gradient(left, #1f12d3, #6b75e0);color:white;">
                        <tr>
                            <td></td>
                            <td>Form id</td>
                            <td>Student</td>
                            <td>Term</td>
                            <td>Subject</td>
                            <td>Date</td>
                            <td>Status</td>
                        </tr>
                    </thead>
                </table> -->
          </div>

                <form action=" {% url 'courses:confirmapplication' %} ">
                    <table class="table table-hover" id="application_table">
                            <thead class="thead" style="background:-webkit-linear-gradient(left, #1f12d3, #6b75e0);color:white;">
                                <tr>
                                    <td></td>
                                    <td>Form id</td>
                                    <td>Student</td>
                                    <td>Term</td>
                                    <td>Subject</td>
                                    <td>Date</td>
                                    <td>Status</td>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in form %}
                                <tr id="form-data" data-id="{{item.form_id}}">
                                    <td><input type="radio" name="application_radio" value="{{item.application_id}}">
                                    </td>
                                    <td>{{item.application_id}}</td>
                                    <td id="student_name_td">{{item.student.student_user.full_name}}</td>
                                    <td>
                                        <table style="margin: 0;">
                                            {%for exam in item.exam.all%}
                                            <tr><td>{{exam}}</td></tr>
                                        {% endfor %}
                                        </table>
                                    </td>
                                    <td><table>
                                        {%for exam in item.exam.all%}
                                        <tr><td>{{exam.subject_id}}</td></tr>
                                        {% endfor %}
                                    </table></td>
                                    <td><table>
                                        {%for exam in item.exam.all%}
                                        <tr><td>{{exam.date}}</td></tr>
                                        {% endfor %}
                                    </table></td>
                                    <td>{% if item.status == False %}
                                        <span class="btn btn-sm btn-danger">
                                            <strong>Pending</strong>
                                        </span>
                                        
                                        {% else %}
                                        <span class="btn btn-sm btn-success">
                                            <strong>Registered</strong>
                                        </span>
                                        {% endif %}
                                    </td>
                                    <td id="term_td" hidden readonly>{{item.term}}</td>
                                </tr>
                                {% endfor %}
                                <td colspan="7" align="right"><button type="button" class="btn btn-primary" id="open-ApplyDialog" data-toggle="modal" data-target = "#confirm-modal">
                                    Confirm
                                </button></td>
                
                            </tbody>
                
                            <div class="modal fade" id="confirm-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Exam Application</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    </div>
                                    <div class="modal-body">
                                    <div id="Application">
                                        Confirm <span id="student_span"></span>'s application for <span id="term_span"></span>?
                                    </div>
                                    </div>
                                    <div class="modal-footer">
                                    <button type="button" id="firstmodal_close_button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <input type="submit" class="btn btn-primary" id="confirm-button" value="Confirm">
                                    </div>
                                </div>
                                </div>
                            </div>
                    </table>
                </form>
                
              
            
        </div>
        <!-- /.card -->
  
  
  
      </div>
    </div>
    </div>
  </section>
{% endblock %}

{% block javascript %}
    <script>
        $("#form-confirm-button").click(function(event){
            var form_id = $("#application_id").val()

            if(form_id==""){
                alert("Please enter form id.")
            }else{
                $.ajax({
                    url: " {% url 'courses:confirmAjax' %}",
                    data: {'form_id':form_id},
                    success: function(data){
                        $("#application-list").html(data)
                    }
                })
            }

        })
    </script>

    <script>
        $(function() {
            $("#open-ApplyDialog").attr('disabled',true);
        });
    
        $(':radio').click(function(){
            $("#open-ApplyDialog").attr('disabled',false);
        }) 
    
        $('#application_table tr').click(function() {
            $(this).find('input:radio').prop('checked', true);
            $("#open-ApplyDialog").attr('disabled',false);
        });
    
        $("#open-ApplyDialog").click(function(event){
            var student = $('input[name="application_radio"]:checked').parent().parent().children("td#student_name_td").text();
            var term = $('input[name="application_radio"]:checked').parent().parent().children("td#term_td").text();
            $("#student_span").text(student)
            $("#term_span").text(term)
        })
    </script>
{% endblock %}