{% load static %}
{% load auth_extras %}

<!DOCTYPE html>
<html>

{% block head %}


<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  {% include "includes/adminlte_css.html" %}
  {% include "includes/datatables_css.html" %}
 
  <link
  rel="stylesheet"
  href="{% static 'plugins/select2-bootstrap4-theme/select2-bootstrap4.css' %}"
/>
<link
  rel="stylesheet"
  href="{% static 'plugins/select2/css/select2.css' %}"
/>
<link href="{% static 'main_dashboard/css/loader.css' %}" rel="stylesheet">
  <title> {% block title %} {% endblock %}</title>
  <!-- <link rel="icon" type="images/jpg" href="">  -->
  <!-- <link rel="icon" type="images/jpg" href="">  -->
  <link rel="icon" type="images/jpg" href="{% static 'image/easy-academy-1.png' %}"> 
  {% block head_css %}
  {% endblock head_css%}
</head>

{% endblock head %}

<body class="hold-transition sidebar-mini layout-fixed">
  <div class="page-loader home-loader">
    <div class="inner-loader">
      <div class="spinner-border text-center" style="width: 3rem; height: 3rem;" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      <div class="spinner-grow text-center" style="width: 3rem; height: 3rem;" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      <div class="loader__figure" />
    </div>
  </div>
</div>

  <div class="wrapper">

    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars" style="background-color: black;"></i></a>
        </li>
      </ul>
      <h5 style="margin-left: 10px;margin-top: 5px;">Management  Information  System</h5>

 <!----------------------------------------------------------------- Right navbar links --------------------------------------------------->
                            {% include "includes/right_navbar.html" %}
 <!----------------------------------------------------------------- Right navbar links --------------------------------------------------->


    <!-- Main Sidebar Container -->
    {% include 'includes/include_admin/admin_sidebar.html'%}

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-6">
              <h2 class="m-0 text-dark">
                <!-- {% block page_title %}{% endblock page_title %} -->
              </h2>

            </div>

            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <!-- <li class="breadcrumb-item"><a href="/admin_content/">Home</a></li> -->
              </ol>
            </div>

            <!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->

      {% block main_content %}{% endblock main_content %}
      {% block content %}{% endblock content %}
    </div>


    <!-- /.content-wrapper -->

  </div>

  <!-- ./wrapper -->
  {% comment %} <div class="row no-print">
    <footer class="main-footer">

    <div class="row">
      <div class="col-md-12">
        <strong>Copyright &copy; {% now 'Y' %} <a href=""></a>.</strong> All rights
        reserved.
      </div>
     
    </div>
  
     
    </footer>
    <div class="mt-4" style="margin-left: 55%;">
      <b>Version</b> {{setting_instance.version}}
    </div>
   
  </div> {% endcomment %}


  <!----------For AdminLTE bootstrap js link--------------->
  {% include "includes/adminlte_jquery.html" %}
  <!--------------for datatables---------------------->
  <!--for datatables csv pdf -- code --------------->
  {% include "includes/datatables_js.html" %}

  

  {% block custom_css %}{% endblock custom_css %}
  {% block custom_js %}{% endblock custom_js %}
  {% block javascript %}{% endblock %}
  <div id="confirm-modal" class="modal fade">
    <div class="modal-dialog modal-confirm">
      <div class="modal-content">
        <div class="modal-header flex-column">
          <div class="icon-box"></div>
          <h4 class="modal-title text-center w-100">Are you sure?</h4>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-hidden="true"
          >
            &times;
          </button>
        </div>
        <div class="modal-body text-center">
          <p class="confirm-message"></p>
        </div>
        <div class="modal-footer justify-content-center"></div>
      </div>
    </div>
  </div>
</body>
<script
type="text/javascript"
src="{% static 'flipbook/pdfjs-flipbook/js/jquery.fancybox.min.js' %}"
></script>
  <!-- flipbook js -->
  <link
  rel="stylesheet"
  type="text/css"
  href="{% static 'flipbook/pdfjs-flipbook/css/jquery.fancybox.min.css' %}"
/>
<link rel="stylesheet" href="{% static 'plugins/select2-bootstrap4-theme/select2-bootstrap4.css' %}">
<link rel="stylesheet" href="{% static 'plugins/select2/css/select2.css' %}">
<!-- <script src="{% static 'plugins/jquery-ui/jquery-ui.min.js' %}"></script> -->

<script src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
<script src="{% static 'plugins/jquery-mousewheel/jquery.mousewheel.js' %}"></script>
<script src="{% static 'plugins/raphael/raphael.min.js' %}"></script>
<script src="{% static 'plugins/jquery-mapael/jquery.mapael.min.js' %}"></script>
<script>
  
  

/*
    $(function(){
      $('.select').select2({theme: 'bootstrap4'});
      $('.selectmultiple').select2({theme: 'bootstrap4'});
  });
*/
  
  $(document).ready(function() {
 
    $('#notification').on("click",function(){
      $("#notification_count").hide();
      console.log('clicked');
      $.ajax({
              type: "GET",
              url: "{% url 'notifications:update_notification' %}",
              dataType: 'json',
              success: function(response){
                console.log(response)
                $("#notification_count").html("");
              },error:function(response){
                  return false;
              }
          });
  });   
  });

  

</script>

<script>
  function Confirmation(message='',callback,confirm_action='delete'){
    $('#confirm-modal').modal('toggle');
    $('#confirm-modal').find('.confirm-message').html(message);
    if(confirm_action =='delete' || confirm_action =='temp_delete'){
      $('#confirm-modal').find('.modal-footer').html(`<button id="confirm-yes" class="btn btn-danger">Delete</button>
      <button type="button" id="confirm-no" class="btn btn-secondary" data-dismiss="modal">
          Cancel
        </button>`);
      $('#confirm-modal').find('.icon-box').html('<i class="fas fa-times"></i>');
    }else{
      $('#confirm-modal').find('.modal-footer').html(`<button id="confirm-yes" class="btn btn-success">Yes</button>
      <button type="button" id="confirm-no" class="btn btn-secondary" data-dismiss="modal">
          No
        </button>`);
        $('#confirm-modal').find('.icon-box').html('<i class="fas fa-check"></i>');
    }
    let confirm_btn = document.getElementById('confirm-yes');
    confirm_btn.onclick = function(){callback(true);$('#confirm-modal').modal('toggle');}

}

function deleteSelected({table,id,message_title, model,app_name,replace_app_name,action='delete'}={}) {
    let ids = $.map(table.rows(".selected").data(), function (item) {
      return item[id];
    });
    if (action == 'delete'){

      message = "Do you really want to delete these record? This process cannot be undone.";
    }else{
      message = "Do you really want to restore these record? This process cannot be undone.";
    }
    if (ids.length > 0) {
      Confirmation(
        message,
        function (response) {
          if (response) {
            $.ajax({
              type: "POST",
              headers: { "X-CSRFToken": "{{csrf_token}}" },
              url: "{% url 'mass_delete' app='app_name' model='Model' %}".replace( "Model",model).replace('app_name',replace_app_name),
              data: {
                ids: ids,
                action:action
              },
              success: function () {
                table.ajax.reload();
                toastr.success(
                  `${message_title} data were sucessfully deleted`
                );
              },
            });
          }
        },action
      );
    } else {
      toastr.error("No row selected", "Error");
    }
  }
  function getDataTableConfig({
    table_id,
    delete_id_key,
    message_title,
    Model,
    action_index,
    edit_url,
    delete_url,
    view_url,
    app_name = "",
    replace_app_name = "",
    default_order_index = 2,
    append_action = "",
    additionalColumn = [],
    action = 'delete',
    additionalConfig = {},
    permissionConfig = [],
    csvGenerateUrl = '',
    showRestoreSelected = false,
    exportName = '',
  }={}) {

    let delteSelected = {};
    if(!showRestoreSelected){
      delteSelected = {
          text: "Delete Selected",
          action: function (e, dt, node, config) {
            deleteSelected({table:$(table_id).DataTable(), id:delete_id_key, message_title:message_title,model: Model,app_name:app_name,replace_app_name:replace_app_name,action:action});
          },
        }
    }else{
      delteSelected = {
          text: "Restore Selected",
          action: function (e, dt, node, config) {
            deleteSelected({table:$(table_id).DataTable(), id:delete_id_key, message_title:message_title,model: Model,app_name:app_name,replace_app_name:replace_app_name,action:'restore'});
          },
        }
    }

    return {
      dom: "B<'m-2 row d-flex justify-content-between extra-container'l<'extra'>f>rtip",
      buttons: [
        "csv",
        "excel",
        "colvis",
        delteSelected,
        {
          text: "Export All",
          action: function (e, dt, node, config) {

            exportSelected({model: Model,app_name:app_name,replace_app_name:replace_app_name, csvGenerateUrl: csvGenerateUrl,exportName:exportName});
          },
        },
      ],
      pageLength: 50,
      "processing": true,
      "language": {
        processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw text-success"><i>'
        },
      columnDefs: [
        {
          targets: 0,
          width: 20,
          orderable: false,
          className: "select-checkbox",
          searchable: false,
          render: function (data, type, row, meta) {
            return "";
          },
        },
        {
          targets: action_index,
          searchable: false,
          orderable: false,
          render: function (data, type, row, meta) {
            return getAppendData(
              row,edit_url,delete_url,view_url,delete_id_key,
              append_action,permissionConfig
            );
          },
        },
        {
          targets: 1,
          visible: false,
          searchable: false,
        },
        {
          targets: 2,
          searchable: false,
          render: function (data, type, row, meta) {
            return meta.row+1;
          },
        },


      ].concat(additionalColumn),
      select: {
        style: "multi",
        selector: "td:first-child",
      },
      order: [[default_order_index, "desc"]],
      serverSide: true,
      fixedHeader: true,
      ...additionalConfig,
    };
  }
  function getAppendData(row, edit_url, delete_url,view_url, id,append_action = "",permissionConfig) {
    let edit_href = edit_url.replace("pk_val", row[id]);
    let delete_href = delete_url.replace("pk_val", row[id]);
    let view_href = view_url.replace("pk_val", row[id]);

    let appendData = '';
    
      appendData+=`
      <div class="btn-group">
        <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <strong>Action</strong>
        </button>
        <div class="dropdown-menu">
      
          
          <a class="dropdown-item" href="${view_href}">View Student Details</a>
          <a class="dropdown-item" href="${edit_href}">Edit</a>
          <form action="${delete_href}" method="POST" class="delete-form">{% csrf_token %}
            <a type="submit" class = "ml-3 btn-delete">Delete</a>
          </form>
        </div>
      </div>
      `
 
  
    
    return (appendData
       +
      append_action.replace(/pk_val/g,row[id])
    );
  }
 $("#checkBox").on("click", function () {
          table_id = $(this).parents('table').attr('id');
          table = $('#'+table_id).DataTable();
            if ($("#checkBox").is(":checked")) {
              table.rows().select();
            } else {
              table.rows().deselect();
            }
          });

    $(function(){



        $(document).on('click','.btn-delete',function(event){
            let url = $(this).attr('href');
            let form = $(this).parents('form');
            event.preventDefault();
            Confirmation(
              "Do you really want to delete these record? This process cannot be undone.",
              function (response) {
                if (response) {
                  form.trigger('submit');
                }
              });
        });

        $(document).on('click','.btn-trash',function(event){

            let url = $(this).attr('href');
            event.preventDefault();
            Confirmation(
              "Do you really want to delete these record? This process cannot be undone.",
              function (response) {
                if (response) {
                  window.location.replace(url);
                }
              });
        });

        $(document).on('click','.btn-restore',function(event){
            let url = $(this).attr('href');
            let form = $(this).parents('form');
            event.preventDefault();
            Confirmation(
              "Do you really want to restore these record?",
              function (response) {
                if (response) {
                  form.trigger('submit');
                }
              },'restore');
        });

        $('form').submit(function(e){
            $(this).find(':submit').prop('disabled',true);
        });

        // $('.dataTable').dataTable();


       

      });
    
        $(document).ready(function(){
          $('.page-loader').hide();
        });


        {% comment %} for course select field with radio field  {% endcomment %}
  $("#div_id_course_category input:radio").click(function(){
    var course_category_id = $(this).val();
    
    $.ajax({
        url:" {% url 'attendance_app:fill_semester_select' %}",
        data:{'course_category':course_category_id},
        success:function(data){
            $("#id_semester").html(data);
        }
    })
})

{% comment %} for course select field  {% endcomment %}
$("#id_course_category").change(function(){
  var course_category_id = $(this).val();
  
  
  $.ajax({
      url:" {% url 'attendance_app:fill_semester_select' %}",
      data:{'course_category':course_category_id},
      success:function(data){
          $("#id_filter_semester").html(data);
      }
  })
})

$("#id_semester").change(function(){
  var semester_id = $(this).val();
  
  
  $.ajax({
      url:" {% url 'attendance_app:fill_section_select' %}",
      data:{'semester':semester_id},
      success:function(data){
          $("#id_section").html(data);
      }
  })
})



$("#id_semester").change(function(){
  var semester_id = $(this).val();
  var course_category_id = $('#id_course_category').val();
  
  
  $.ajax({
      url:" {% url 'attendance_app:fill_subject_select' %}",
      data:{'semester':semester_id,'course_category':course_category_id},
      success:function(data){
          $("#id_Subject").html(data);
      }
  })
})
</script>


<style>
{% comment %} For inline radion botton {% endcomment %}
  .form-check,.custom-control, .form-check-input{
    display:inline-block;
    }
    .form-check,.custom-control{
     margin-left:1.5rem;
   }
  .nav-sidebar .nav-link p {
  font-family: "Source Sans Pro";
  margin-top:10px;
 
} 
a,p,th,td,tr,h1,h2,h3,h4,h5,h6,div,span,i,li,ol,ul{
  font-family: "Source Sans Pro";

}
{% comment %} For active hover {% endcomment %}
  .nav-item.nav-link.active{
     background-color: #fff;
     color:#7650B9;
      }
      
      .nav-item.nav-link.active>i{
        background-color: #fff;
        color:#7650B9;

      }
    
   .nav-pills .nav-link{
     color:white;
   }
   
 </style>

</html>